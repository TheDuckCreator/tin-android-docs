<!DOCTYPE html> <html lang="en-US"> <head> <meta charset="UTF-8"> <meta http-equiv="X-UA-Compatible" content="IE=Edge"> <title>ViewModel and ViewModel Factory - Tin Android Docs</title> <link rel="shortcut icon" href="/tin-android-docs/favicon.ico" type="image/x-icon"> <link rel="stylesheet" href="/tin-android-docs/assets/css/just-the-docs.css"> <script type="text/javascript" src="/tin-android-docs/assets/js/vendor/lunr.min.js"></script> <script type="text/javascript" src="/tin-android-docs/assets/js/just-the-docs.js"></script> <meta name="viewport" content="width=device-width, initial-scale=1"> <!-- Begin Jekyll SEO tag v2.6.1 --> <title>ViewModel and ViewModel Factory | Tin Android Docs</title> <meta name="generator" content="Jekyll v3.8.5" /> <meta property="og:title" content="ViewModel and ViewModel Factory" /> <meta property="og:locale" content="en_US" /> <meta name="description" content="This is the part of Project E-health for Personal Sensor Application (Android Application). I has prepare my android skill for this project, the docs will be in Thai and English" /> <meta property="og:description" content="This is the part of Project E-health for Personal Sensor Application (Android Application). I has prepare my android skill for this project, the docs will be in Thai and English" /> <link rel="canonical" href="/tin-android-docs/AndroidFundamental/ViewModel.html" /> <meta property="og:url" content="/tin-android-docs/AndroidFundamental/ViewModel.html" /> <meta property="og:site_name" content="Tin Android Docs" /> <script type="application/ld+json"> {"@type":"WebPage","url":"/tin-android-docs/AndroidFundamental/ViewModel.html","headline":"ViewModel and ViewModel Factory","description":"This is the part of Project E-health for Personal Sensor Application (Android Application). I has prepare my android skill for this project, the docs will be in Thai and English","@context":"https://schema.org"}</script> <!-- End Jekyll SEO tag --> </head> <body> <svg xmlns="http://www.w3.org/2000/svg" style="display: none;"> <symbol id="link" viewBox="0 0 16 16"> <title>Link</title> <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path> </symbol> </svg> <div class="page-wrap"> <div class="side-bar"> <div class="site-header"> <a href="/tin-android-docs" class="site-title lh-tight"> Tin Android Docs </a> <button class="menu-button fs-3 js-main-nav-trigger" data-text-toggle="Hide" type="button">Menu</button> </div> <div class="navigation main-nav js-main-nav"> <nav role="navigation" aria-label="Main navigation"> <ul class="navigation-list"><li class="navigation-list-item active"><a href="/tin-android-docs/404.html" class="navigation-list-link"></a></li><li class="navigation-list-item"><a href="/tin-android-docs/AndroidFundamental/BasicKotlin.html" class="navigation-list-link">Basic Kotlin Lang</a></li><li class="navigation-list-item"><a href="/tin-android-docs/AndroidFundamental/DataBinding.html" class="navigation-list-link">DataBinding</a></li><li class="navigation-list-item"><a href="/tin-android-docs/AndroidFundamental/LiveData.html" class="navigation-list-link">LiveData</a></li><li class="navigation-list-item"><a href="/tin-android-docs/AndroidFundamental/RoomDatabaseBasic.html" class="navigation-list-link">Room Database</a></li><li class="navigation-list-item active"><a href="/tin-android-docs/AndroidFundamental/ViewModel.html" class="navigation-list-link active">ViewModel and ViewModel Factory</a></li><li class="navigation-list-item"><a href="/tin-android-docs/about/" class="navigation-list-link">About</a></li><li class="navigation-list-item"><a href="/tin-android-docs/" class="navigation-list-link">Theethawat Android Documents</a></li><hr /> </ul> </nav> </div> <footer class="site-footer"> <p class="text-small text-grey-dk-000 mb-4">This site uses <a href="https://github.com/pmarsceill/just-the-docs">Just the Docs</a>, a documentation theme for Jekyll.</p> </footer> </div> <div class="main-content-wrap js-main-content" tabindex="0"> <div class="main-content"> <div class="page-header js-page-header"> <div class="search"> <div class="search-input-wrap"> <input type="text" class="js-search-input search-input" tabindex="0" placeholder="Search Tin Android Docs" aria-label="Search Tin Android Docs" autocomplete="off"> <svg width="14" height="14" viewBox="0 0 28 28" xmlns="http://www.w3.org/2000/svg" class="search-icon"><title>Search</title><g fill-rule="nonzero"><path d="M17.332 20.735c-5.537 0-10-4.6-10-10.247 0-5.646 4.463-10.247 10-10.247 5.536 0 10 4.601 10 10.247s-4.464 10.247-10 10.247zm0-4c3.3 0 6-2.783 6-6.247 0-3.463-2.7-6.247-6-6.247s-6 2.784-6 6.247c0 3.464 2.7 6.247 6 6.247z"/><path d="M11.672 13.791L.192 25.271 3.02 28.1 14.5 16.62z"/></g></svg> </div> <div class="js-search-results search-results-wrap"></div> </div> </div> <div class="page"> <div id="main-content" class="page-content" role="main"> <h1 id="viewmodel-and-viewmodelfactory"> <a href="#viewmodel-and-viewmodelfactory" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#link"></use></svg></a> ViewModel and ViewModelFactory </h1> <p>Program Bootstrap with Viewmodel and ViewModelFactory Starter Code from Google Codelabs from this link <a href="https://codelabs.developers.google.com/codelabs/kotlin-android-training-view-model/">Code Lab Link</a></p> <h2 id="meaning-of-viewmodel-and-viewmodelfactory"> <a href="#meaning-of-viewmodel-and-viewmodelfactory" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#link"></use></svg></a> Meaning of ViewModel and ViewModelFactory </h2> <ul> <li><strong>ViewModel</strong> is class to store and manage UI-related data, it allow data survive in device configure saturation (like screen rotation).</li> <li><strong>ViewModelFactory</strong> is class to instantiate and return ViewModel</li> </ul> <h2 id="managing-configuration-changes-problem"> <a href="#managing-configuration-changes-problem" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#link"></use></svg></a> Managing Configuration Changes Problem </h2> <p>Configure change like screen rotation, screen close or anything can make program run into problem the <code class="language-plaintext highlighter-rouge">ViewModelFactory</code> can make the <code class="language-plaintext highlighter-rouge">ViewModel</code> use in many configure change.</p> <p>For handling th problem of configure changes can use <code class="language-plaintext highlighter-rouge">savedInstanceState()</code> to save and store device configure like screen rotation but it’s too mush lines of codes and can store minimum data. It more than useful if use Design under Android Architecture Guideline (lifecycle).It more better to seperate UI Controller , <code class="language-plaintext highlighter-rouge">ViewModel</code> and <code class="language-plaintext highlighter-rouge">ViewModelFactory</code> and make it under <strong><em>Seperation of Concern</em></strong></p> <h2 id="seperation-of-concern"> <a href="#seperation-of-concern" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#link"></use></svg></a> Seperation of Concern </h2> <ul> <li>UI Controller must only contain logic to handle UI, no decision making logic</li> <li>ViewModel hold data to Display,Simple Calculate and Transformation, decision making</li> <li>ViewModelFactory contains business logic to perform simple calculation and decide of ViewModel</li> </ul> <p>In Configure Change like screen-rotation fragment will be destroy but ViewModel is still alive</p> <h2 id="viewmodelprovider"> <a href="#viewmodelprovider" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#link"></use></svg></a> ViewModelProvider </h2> <p>If we use viewModel instance using <code class="language-plaintext highlighter-rouge">ViewModel</code> class, object will create everytime when fragment is re-created. For the better result we can Instance ViewModel using <code class="language-plaintext highlighter-rouge">ViewModelProvider</code></p> <ul> <li><code class="language-plaintext highlighter-rouge">ViewModelProvider()</code> return existing ViewModel (if exists) or create a new one if not exist will Create ViewModel instance in association with given scope</li> <li> <p><code class="language-plaintext highlighter-rouge">ViewModelProviders.of()</code> is for Initial ViewModel use that To Create ViewModelProvider like</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  viewModel = ViewModelProviders.of(this).get(GameViewModel::class.java)
</code></pre></div> </div> <p>inside of is <code class="language-plaintext highlighter-rouge">FragmentActivity</code> so <code class="language-plaintext highlighter-rouge">this</code> refer to fragment and <code class="language-plaintext highlighter-rouge">.get()</code> is get the model to make this is fragment activity.</p> </li> </ul> <h2 id="viewmodelfactory"> <a href="#viewmodelfactory" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#link"></use></svg></a> ViewModelFactory </h2> <p>Sometimes the value must pass to viewModel at the initialization part, so we have the problem that we pass value and it don’t affect UI because the initialization is running out. Factory Method Pattern is the way to let <code class="language-plaintext highlighter-rouge">ViewModel</code> wait for value to initialize or another logic that programmer want and then we pass value into ViewModel on Initialization part.</p> <p>ViewModelFactory uses factory to create objects while <strong>Factory</strong> method is a method that return the copy of the same class.</p> <h2 id="viewmodelfactory-class"> <a href="#viewmodelfactory-class" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#link"></use></svg></a> ViewModelFactory Class </h2> <p>ViewModelFactory Class will take responsible for make a copy of that ViewModel object it will extend from <code class="language-plaintext highlighter-rouge">ViewModelProvider.Factory</code></p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>class ScoreViewModelFactory(private val finalScore: Int):ViewModelProvider.Factory{}
</code></pre></div></div> <p>After we write the prototype of this class IDE will automatically appear error that we are not implement abstract method.</p> <p>The Solution to solve this is to override <code class="language-plaintext highlighter-rouge">create</code> method that will let <code class="language-plaintext highlighter-rouge">modelClass</code> to create <strong>ViewModel</strong> class like this</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  override fun &lt;T : ViewModel?&gt; create(modelClass: Class&lt;T&gt;): T {
    // If model class is correct return them as ViewModel with Value
    if(modelClass.isAssignableFrom(ScoreViewModel::class.java)){
        return  ScoreViewModel(finalScore) as T
    }
    throw IllegalArgumentException("Unknown ViewModel Class")
}
</code></pre></div></div> <h3 id="create-viewmodel-from-viewmodel-factory-class"> <a href="#create-viewmodel-from-viewmodel-factory-class" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#link"></use></svg></a> Create ViewModel From ViewModel Factory Class </h3> <ul> <li> <p>Initial value of <code class="language-plaintext highlighter-rouge">viewModelFactory</code> Variable by Pass the value from argument bundle as a constructor of Factory class</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>private lateinit var viewModelFactory: ScoreViewModelFactory
viewModelFactory = ScoreViewModelFactory(ScoreFragmentArgs.fromBundle(arguments!!).score)
</code></pre></div> </div> </li> <li> <p>Create <code class="language-plaintext highlighter-rouge">ViewModel</code> from <code class="language-plaintext highlighter-rouge">ViewModelFactory</code></p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>private lateinit var viewModel:ScoreViewModel
viewModel = ViewModelProviders.of(this,viewModelFactory).get(ScoreViewModel::class.java)
</code></pre></div> </div> </li> </ul> </div> </div> </div> </div> </body> </html>
